name: Update Release
on:
  push:
    tags:
      - "**"
jobs:
  build:
    name: build
    strategy:
      fail-fast: true
      matrix:
        gameVersion: [011403, 030400, 100000]
        name: ["ARCadia-classic", "ARCadia-classic-WoTLK", "ARCadia"]

    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          submodules: recursive
      - name: Run
        id: create_release
        run: ./build.sh -i ${{ matrix.gameVersion }} -n ${{ matrix.name }}
        shell: bash
      - name: Upload Release Asset
      
        id: upload-release-asset 
        uses: svenstaro/upload-release-action@v2
        with:
          repo_token: ${{ secrets.RELEASE_PAT }}
          file: ./build/${{ matrix.name }}-${{ github.ref_name }}.zip
          asset_name: ${{ matrix.name }}-${{ github.ref_name }}.zip
          tag: ${{ github.ref }}
          overwrite: true
      - name: Upload to Curseforge
        uses: itsmeow/curseforge-upload@v3
        with:
          token: ${{ secrets.CURSEFORGE_TOKEN }}
          project_id: ${{ secrets.PROJECT_ID }}
          game_endpoint: wow
          file_path: ./build/${{ matrix.name }}-${{ github.ref_name }}.zip
